<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<META http-equiv="Content-Type" content="text/html; charset=UTF-8">
<!--
This HTML was auto-generated from MATLAB code.
To make changes, update the MATLAB code and republish this document.
      -->
<title>ManufacturingSpaceStationCAD</title>
<meta name="generator" content="MATLAB 24.1">
<link rel="schema.DC" href="http://purl.org/dc/elements/1.1/">
<meta name="DC.date" content="2025-06-24">
<meta name="DC.source" content="ManufacturingSpaceStationCAD.m">
<style type="text/css">
html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,font,img,ins,kbd,q,s,samp,small,strike,strong,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td{margin:0;padding:0;border:0;outline:0;font-size:100%;vertical-align:baseline;background:transparent}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:before,blockquote:after,q:before,q:after{content:'';content:none}:focus{outine:0}ins{text-decoration:none}del{text-decoration:line-through}table{border-collapse:collapse;border-spacing:0}

html { min-height:100%; margin-bottom:1px; }
html body { height:100%; margin:0px; font-family:Arial, Helvetica, sans-serif; font-size:10px; color:#000; line-height:140%; background:#fff none; overflow-y:scroll; }
html body td { vertical-align:top; text-align:left; }

h1 { padding:0px; margin:0px 0px 25px; font-family:Arial, Helvetica, sans-serif; font-size:1.5em; color:#d55000; line-height:100%; font-weight:normal; }
h2 { padding:0px; margin:0px 0px 8px; font-family:Arial, Helvetica, sans-serif; font-size:1.2em; color:#000; font-weight:bold; line-height:140%; border-bottom:1px solid #d6d4d4; display:block; }
h3 { padding:0px; margin:0px 0px 5px; font-family:Arial, Helvetica, sans-serif; font-size:1.1em; color:#000; font-weight:bold; line-height:140%; }

a { color:#005fce; text-decoration:none; }
a:hover { color:#005fce; text-decoration:underline; }
a:visited { color:#004aa0; text-decoration:none; }

p { padding:0px; margin:0px 0px 20px; }
img { padding:0px; margin:0px 0px 20px; border:none; }
p img, pre img, tt img, li img, h1 img, h2 img { margin-bottom:0px; }

ul { padding:0px; margin:0px 0px 20px 23px; list-style:square; }
ul li { padding:0px; margin:0px 0px 7px 0px; }
ul li ul { padding:5px 0px 0px; margin:0px 0px 7px 23px; }
ul li ol li { list-style:decimal; }
ol { padding:0px; margin:0px 0px 20px 0px; list-style:decimal; }
ol li { padding:0px; margin:0px 0px 7px 23px; list-style-type:decimal; }
ol li ol { padding:5px 0px 0px; margin:0px 0px 7px 0px; }
ol li ol li { list-style-type:lower-alpha; }
ol li ul { padding-top:7px; }
ol li ul li { list-style:square; }

.content { font-size:1.2em; line-height:140%; padding: 20px; }

pre, code { font-size:12px; }
tt { font-size: 1.2em; }
pre { margin:0px 0px 20px; }
pre.codeinput { padding:10px; border:1px solid #d3d3d3; background:#f7f7f7; }
pre.codeoutput { padding:10px 11px; margin:0px 0px 20px; color:#4c4c4c; }
pre.error { color:red; }

@media print { pre.codeinput, pre.codeoutput { word-wrap:break-word; width:100%; } }

span.keyword { color:#0000FF }
span.comment { color:#228B22 }
span.string { color:#A020F0 }
span.untermstring { color:#B20000 }
span.syscmd { color:#B28C00 }
span.typesection { color:#A0522D }

.footer { width:auto; padding:10px 0px; margin:25px 0px 0px; border-top:1px dotted #878787; font-size:0.8em; line-height:140%; font-style:italic; color:#878787; text-align:left; float:none; }
.footer p { margin:0px; }
.footer a { color:#878787; }
.footer a:hover { color:#878787; text-decoration:underline; }
.footer a:visited { color:#878787; }

table th { padding:7px 5px; text-align:left; vertical-align:middle; border: 1px solid #d6d4d4; font-weight:bold; }
table td { padding:7px 5px; text-align:left; vertical-align:top; border:1px solid #d6d4d4; }





  </style>
</head>
<body>
<div class="content">
<h2>Contents</h2>
<div>
<ul>
<li>
<a href="#1">Design a manufacturing space station</a>
</li>
<li>
<a href="#2">Properties</a>
</li>
<li>
<a href="#3">Initialize BuildCADModel and create the Core body</a>
</li>
<li>
<a href="#4">Add subsystems</a>
</li>
<li>
<a href="#5">Update the mass properties to produce the tables</a>
</li>
<li>
<a href="#6">Show the vehicle and save the components</a>
</li>
<li>
<a href="#7">Export to an obj file for use by other software</a>
</li>
<li>
<a href="#8">Compute the thruster torque distribution</a>
</li>
<li>
<a href="#9">Make a simple CAD Model for disturbance analyses</a>
</li>
<li>
<a href="#10">Save the data for the simulation</a>
</li>
</ul>
</div>
<h2 id="1">Design a manufacturing space station</h2>
<p>Large space station with a Hall thruster for stationkeeping, hydrazine RCS thrusters, and a robot arm. There is an option for the solar arrays in the model to be deployed or not. This script creates both a full model and a simpler model for disturbance analysis. Both the full model, the thruster layout, and the simple model will be displayed in figures.</p>
<p>If file saving is turned on, this script saves the following:</p>
<pre>- ManufacturingSpaceStation.mat, the CAD model data structure
- ManufacturingSpaceStation.tex, a latex table
- either the file SpaceStationProps.mat or SpaceStationPropsUndeployed.mat
  with the simplified surface model and thruster layout data
- SpaceStationThruster.txt, the thruster layout data</pre>
<p>It will also export ManufacturingSpaceStation.obj as this is needed by the thruster layout step.</p>
<p>See also AtmDens2, BuildCADModel, CreateBody, CreateComponent, ExportOBJ, ThrusterCAD, XenonTank, VOrbit, HallThrusterArray, ThrusterLayout, Box, Frustrum, DisplayLatexTable, SaveStructure, DrawVertices, PolygonProps, DrawCanadarm3</p>
<pre class="codeinput">
<span class="comment">%--------------------------------------------------------------------------</span>
<span class="comment">%   Copyright (c) 2025 Princeton Satellite Systems, Inc.</span>
<span class="comment">%   All rights reserved.</span>
<span class="comment">%--------------------------------------------------------------------------</span>
<span class="comment">%   Since version 2025.1</span>
<span class="comment">%--------------------------------------------------------------------------</span>

<span class="comment">% Script control</span>
deployed   = true;
saveFiles  = false;

<span class="comment">% Constants</span>
rhoAl    = 2700;
rhoGlass = 2500;
rhoXe    = 3100; <span class="comment">% km/m^2</span>
rhoTi    = 4502; <span class="comment">% kg/m^3</span>
rE       = 6378.165;
tRefuel  = 5*365.25*24*3600; <span class="comment">% 5 years</span>
sigTi    = 0.5*880e6; <span class="comment">% N/m^2 with a factor of safety of 2</span>
effHall  = 0.6;
uEHall   = 20000; <span class="comment">% m/s</span>
massREA  = 0.3;
massHyd  = 200;
pHyd     = 350*6895;
rhoHyd   = 1000;
</pre>
<h2 id="2">Properties</h2>
<pre class="codeinput">
<span class="comment">% Orbit</span>
h  = 350; <span class="comment">% km</span>
cD = 2.7;

<span class="comment">% Tank</span>
pTank = 350*6895;

<span class="comment">% Manufacturing modules</span>
nModules    = 6;
rModule     = 1.0; <span class="comment">% m</span>
lModule     = 1.2*ones(1,6);  <span class="comment">% m</span>
massModule  = 500*ones(1,6);
useModule   = [1 1 1 1 1 1];

<span class="comment">% Bus</span>
lBus        = 2*lModule(1);  <span class="comment">% m</span>
massBus     = 2000;

<span class="comment">% Rail for the robot arm</span>
xRail       = sum(lModule(1:6));
yRail       = 0.1;
zRail       = 0.1;
massRail    = xRail*yRail*zRail*rhoAl*0.1;

<span class="comment">% Keel</span>
xKeel       = sum(lModule(1:6));
yKeel       = 0.2;
zKeel       = 0.2;
massKeel    = xKeel*yKeel*zKeel*rhoAl*0.1;

<span class="comment">% Solar Panels</span>
power     = 20000;
eff       = 0.31;
areaSP    = power/(eff*1367)/2;
wSP       = 2*rModule;
lSP       = areaSP/wSP;
tSP       = 0.04;
lStrut    = rModule;
massPanel = wSP*tSP*lSP*rhoGlass;
massStrut = lStrut*tSP^2*rhoAl;

<span class="comment">% Hall Thruster</span>
massHallThruster       = 3;
wHallThruster          = 0.5;
rHallThrusterGimbal    = 0.25*wHallThruster;
lHallThrusterGimbal    = 0.5*wHallThruster;
massHallThrusterGimbal = 0.75;

<span class="comment">% Fuel Tank</span>
r         = rE + h;
v         = VOrbit(r,r)*1000;
fHall     = 0.5*AtmDens2(h)*cD*v^2*(areaSP+4*rModule^2);
powerHall = 0.5*fHall*uEHall/effHall;

massXe   = fHall*tRefuel/uEHall;
volXe    = massXe/rhoXe;
rXeTank  = (0.75*volXe/pi)^(1/3);
tWall    = pTank*rXeTank/(2*sigTi);
massTank = tWall*4*pi*rXeTank^2;

<span class="comment">% Robot arm</span>
rLink    = 0.2; <span class="comment">% m</span>
lLink    = 2; <span class="comment">% m</span>
nLinks   = 3; <span class="comment">% m</span>
tLink    = 0.002; <span class="comment">% Thickness of link strut m</span>
angY     = [0 0 pi/4 pi/4]; <span class="comment">% Just for the picture</span>
massLink = tLink*2*pi*rLink*lLink*rhoAl;
xRobotArm = 2.2*lModule(1);
</pre>
<h2 id="3">Initialize BuildCADModel and create the Core body</h2>
<pre class="codeinput">BuildCADModel( <span class="string">'initialize'</span> );
BuildCADModel( <span class="string">'set name'</span> , <span class="string">'Manufacturing Space Station'</span> );
BuildCADModel( <span class="string">'set units'</span>, <span class="string">'mks'</span> );

<span class="comment">% Core</span>
m = CreateBody(<span class="string">'make'</span>,<span class="string">'name'</span>,<span class="string">'Core'</span>);
BuildCADModel(<span class="string">'add body'</span>, m );

<span class="comment">% This creates the connections between the bodies</span>
BuildCADModel( <span class="string">'compute paths'</span> );

<span class="comment">% Modules</span>
rA = [0;0;0];
<span class="keyword">for</span> k = 1:nModules
  <span class="keyword">if</span>( useModule(k))
    name = sprintf(<span class="string">'Module %d'</span>,k);
    m = CreateComponent( <span class="string">'make'</span>, <span class="string">'cylinder'</span>, <span class="string">'rUpper'</span>, rModule, <span class="string">'rLower'</span>,rModule,<span class="string">'h'</span>,lModule(k),<span class="keyword">...</span>
                     <span class="string">'n'</span>,20,<span class="string">'faceColor'</span>, <span class="string">'gold foil'</span>,<span class="string">'rA'</span>, rA,<span class="string">'b'</span>,[0 0 1;0 1 0;-1 0 0],<span class="keyword">...</span>
                     <span class="string">'mass'</span>, massModule(k), <span class="string">'name'</span>, name, <span class="string">'body'</span>, 1, <span class="string">'inside'</span>, 0 );
    BuildCADModel( <span class="string">'add component'</span>, m );
  <span class="keyword">end</span>
  rA(1) = rA(1) + lModule(k);
<span class="keyword">end</span>

rA(1) = rA(1) + lBus/2;
rABus = rA;
m = CreateComponent( <span class="string">'make'</span>, <span class="string">'box'</span>, <span class="string">'x'</span>, lBus, <span class="string">'y'</span>,2*rModule,<span class="string">'z'</span>,2*rModule,<span class="keyword">...</span>
                     <span class="string">'faceColor'</span>, <span class="string">'Steel'</span>,<span class="string">'rA'</span>, rABus,<span class="keyword">...</span>
                     <span class="string">'mass'</span>, massBus, <span class="string">'name'</span>, <span class="string">'Bus'</span>, <span class="string">'body'</span>, 1, <span class="string">'inside'</span>, 0 );
BuildCADModel( <span class="string">'add component'</span>, m );


<span class="comment">% Add the keel and lateral supports</span>
rA = [sum(lModule(1:3));0;-rModule-zKeel/2];
m = CreateComponent( <span class="string">'make'</span>, <span class="string">'box'</span>, <span class="string">'x'</span>, xKeel, <span class="string">'y'</span>,yKeel,<span class="string">'z'</span>,zKeel,<span class="keyword">...</span>
                     <span class="string">'faceColor'</span>, <span class="string">'aluminum'</span>,<span class="string">'rA'</span>, rA,<span class="keyword">...</span>
                     <span class="string">'mass'</span>, massKeel, <span class="string">'name'</span>, <span class="string">'Keel'</span>, <span class="string">'body'</span>, 1, <span class="string">'inside'</span>, 0 );
BuildCADModel( <span class="string">'add component'</span>, m );

rA = [sum(lModule(1:3));-rModule-zKeel/2;0];
m = CreateComponent( <span class="string">'make'</span>, <span class="string">'box'</span>, <span class="string">'x'</span>, xKeel, <span class="string">'y'</span>,yKeel,<span class="string">'z'</span>,zKeel,<span class="keyword">...</span>
                     <span class="string">'faceColor'</span>, <span class="string">'aluminum'</span>,<span class="string">'rA'</span>, rA,<span class="keyword">...</span>
                     <span class="string">'mass'</span>, massKeel, <span class="string">'name'</span>, <span class="string">'Lateral 1'</span>, <span class="string">'body'</span>, 1, <span class="string">'inside'</span>, 0 );
BuildCADModel( <span class="string">'add component'</span>, m );

rA = [sum(lModule(1:3));rModule+zKeel/2;0];
m = CreateComponent( <span class="string">'make'</span>, <span class="string">'box'</span>, <span class="string">'x'</span>, xKeel, <span class="string">'y'</span>,yKeel,<span class="string">'z'</span>,zKeel,<span class="keyword">...</span>
                     <span class="string">'faceColor'</span>, <span class="string">'aluminum'</span>,<span class="string">'rA'</span>, rA,<span class="keyword">...</span>
                     <span class="string">'mass'</span>, massKeel, <span class="string">'name'</span>, <span class="string">'Lateral 2'</span>, <span class="string">'body'</span>, 1, <span class="string">'inside'</span>, 0 );
BuildCADModel( <span class="string">'add component'</span>, m );

<span class="comment">%  Module supports</span>
rA = [lModule(1)/2-lModule(1)/12;0;0];
rI = rModule;
rO = 1.01*rModule;
lS = lModule(1)/6;
massSupport = rhoAl*pi*(rO^2-rI^2)*lS;
<span class="keyword">for</span> k = 1:6
  [v,f] = PartialThickDisk(rI,rO,lS,12,-pi/2,pi/2);
  s     = sprintf(<span class="string">'Module Support %d'</span>,k);
  m = CreateComponent( <span class="string">'make'</span>, <span class="string">'generic'</span>, <span class="string">'vertex'</span>,v, <span class="string">'face'</span>,f,<span class="keyword">...</span>
                     <span class="string">'faceColor'</span>, <span class="string">'steel'</span>,<span class="string">'rA'</span>, rA,<span class="string">'b'</span>,[0 0 1;0 1 0;-1 0 0],<span class="keyword">...</span>
                     <span class="string">'mass'</span>, massSupport, <span class="string">'name'</span>, s, <span class="string">'body'</span>, 1, <span class="string">'inside'</span>, 0 );
  BuildCADModel( <span class="string">'add component'</span>, m );
  rA(1) = rA(1)+lModule(1);
<span class="keyword">end</span>

<span class="comment">% Solar panels and support struts</span>
<span class="keyword">if</span>( deployed )
  signY = 1;
  <span class="keyword">for</span> k = 1:2
    nameP = sprintf(<span class="string">'Solar Panel %d'</span>,k);
    rAW = [sum(lModule(1:6))+lBus/2;signY*(rModule+lStrut+lSP/2);0];
    m = CreateComponent( <span class="string">'make'</span>, <span class="string">'box'</span>, <span class="string">'x'</span>, tSP, <span class="string">'y'</span>,lSP,<span class="string">'z'</span>,wSP,<span class="keyword">...</span>
                         <span class="string">'faceColor'</span>, <span class="string">'solar cell'</span>,<span class="string">'rA'</span>, rAW,<span class="keyword">...</span>
                          <span class="string">'mass'</span>, massPanel, <span class="string">'name'</span>, nameP, <span class="string">'body'</span>, 1, <span class="string">'inside'</span>, 0 );
    BuildCADModel( <span class="string">'add component'</span>, m );

    nameS = sprintf(<span class="string">'Solar Panel Strut %d'</span>,k);

    rAW(2) = signY*(rModule+lStrut/2);
    m = CreateComponent( <span class="string">'make'</span>, <span class="string">'box'</span>, <span class="string">'x'</span>, tSP, <span class="string">'y'</span>,lStrut,<span class="string">'z'</span>,tSP,<span class="keyword">...</span>
                     <span class="string">'faceColor'</span>, <span class="string">'aluminum'</span>,<span class="string">'rA'</span>, rAW,<span class="keyword">...</span>
                     <span class="string">'mass'</span>, massStrut, <span class="string">'name'</span>, nameS, <span class="string">'body'</span>, 1, <span class="string">'inside'</span>, 0 );
    BuildCADModel( <span class="string">'add component'</span>, m );
    signY = -signY;
  <span class="keyword">end</span>
<span class="keyword">else</span>
  signY = 1;
  <span class="keyword">for</span> k = 1:2
    nameP = sprintf(<span class="string">'Solar Panel %d'</span>,k);
    rA = rABus + [-lSP/2;signY*(rModule);0];
    lSPD = 0.5*lSP;
    m = CreateComponent( <span class="string">'make'</span>, <span class="string">'box'</span>, <span class="string">'x'</span>,lSPD, <span class="string">'y'</span>, tSP,<span class="string">'z'</span>,wSP,<span class="keyword">...</span>
                         <span class="string">'faceColor'</span>, <span class="string">'solar cell'</span>,<span class="string">'rA'</span>, rA,<span class="keyword">...</span>
                          <span class="string">'mass'</span>, massPanel, <span class="string">'name'</span>, nameP, <span class="string">'body'</span>, 1, <span class="string">'inside'</span>, 0 );
    BuildCADModel( <span class="string">'add component'</span>, m );

    nameS = sprintf(<span class="string">'Solar Panel Strut %d'</span>,k);

    rA  = rA + [lSP/2;-signY*(rModule);0];
    m = CreateComponent( <span class="string">'make'</span>, <span class="string">'box'</span>, <span class="string">'x'</span>,lStrut, <span class="string">'y'</span>,tSP,<span class="string">'z'</span>,tSP,<span class="keyword">...</span>
                     <span class="string">'faceColor'</span>, <span class="string">'aluminum'</span>,<span class="string">'rA'</span>, rA,<span class="keyword">...</span>
                     <span class="string">'mass'</span>, massStrut, <span class="string">'name'</span>, nameS, <span class="string">'body'</span>, 1, <span class="string">'inside'</span>, 0 );
    BuildCADModel( <span class="string">'add component'</span>, m );
    signY = -signY;
  <span class="keyword">end</span>

<span class="keyword">end</span>

<span class="comment">% Hall Thruster</span>
[v, f] = HallThrusterArray( wHallThruster );
rA     = [sum(lModule)+2*rHallThrusterGimbal+lBus;0;0];
b      = [0 0 1;0 1 0;-1 0 0];
m = CreateComponent( <span class="string">'make'</span>, <span class="string">'generic'</span>, <span class="string">'vertex'</span>,v, <span class="string">'face'</span>,f,<span class="keyword">...</span>
                     <span class="string">'faceColor'</span>, <span class="string">'steel'</span>,<span class="string">'rA'</span>, rA,<span class="string">'b'</span>,b,<span class="keyword">...</span>
                     <span class="string">'mass'</span>, massHallThruster, <span class="string">'name'</span>, <span class="string">'Hall Thruster'</span>, <span class="string">'body'</span>, 1, <span class="string">'inside'</span>, 0 );
BuildCADModel( <span class="string">'add component'</span>, m );
rA     = [sum(lModule)+2*rHallThrusterGimbal+lBus;0;-lHallThrusterGimbal/2];
rA     = rA -[rHallThrusterGimbal;0;0];
m = CreateComponent( <span class="string">'make'</span>, <span class="string">'cylinder'</span>, <span class="string">'rUpper'</span>,rHallThrusterGimbal, <span class="string">'rLower'</span>,rHallThrusterGimbal,<span class="string">'h'</span>,lHallThrusterGimbal,<span class="keyword">...</span>
                     <span class="string">'faceColor'</span>, <span class="string">'steel'</span>,<span class="string">'rA'</span>, rA,<span class="keyword">...</span>
                     <span class="string">'mass'</span>, massHallThrusterGimbal, <span class="string">'name'</span>, <span class="string">'Hall Thruster Gimbal'</span>, <span class="string">'body'</span>, 1, <span class="string">'inside'</span>, 0 );
BuildCADModel( <span class="string">'add component'</span>, m );

[v,f,dTank] = XenonTank(massXe);
rA = [sum(lModule)+2*rHallThrusterGimbal+lBus;0;0] - [1;0;0.8];
m = CreateComponent( <span class="string">'make'</span>, <span class="string">'generic'</span>, <span class="string">'vertex'</span>,v, <span class="string">'face'</span>,f,<span class="keyword">...</span>
                     <span class="string">'faceColor'</span>, <span class="string">'steel'</span>,<span class="string">'rA'</span>, rA,<span class="keyword">...</span>
                     <span class="string">'mass'</span>, massXe+dTank.massTank, <span class="string">'name'</span>, <span class="string">'Xenon tank'</span>, <span class="string">'body'</span>, 1, <span class="string">'inside'</span>, 1 );
BuildCADModel( <span class="string">'add component'</span>, m );

d      = DrawCanadarm3( <span class="string">'initialize'</span> );
x      = zeros(7,1);
[v,f]  = DrawCanadarm3( <span class="string">'vectors'</span>, x, d );

m = CreateComponent( <span class="string">'make'</span>, <span class="string">'generic'</span>, <span class="string">'vertex'</span>,v, <span class="string">'face'</span>,f,<span class="keyword">...</span>
                     <span class="string">'faceColor'</span>, <span class="string">'steel'</span>,<span class="string">'rA'</span>, rA,<span class="keyword">...</span>
                     <span class="string">'mass'</span>, 100, <span class="string">'name'</span>, <span class="string">'Robot Arm'</span>, <span class="string">'body'</span>, 1, <span class="string">'inside'</span>, 1 );
BuildCADModel( <span class="string">'add component'</span>, m );

<span class="comment">% RCS hydrazine thrusters</span>
lThruster     = 0.026;
dConeThruster = 0.02;
r             = rModule;
x             = lBus/2;

rThruster     = rABus + [x  x -x -x x  x  x  x;<span class="keyword">...</span>
                         r -r  r -r r  r -r -r;<span class="keyword">...</span>
                         r  r  r  r r -r  r -r];
uThruster     =  [ 0 0 0 0 1 1 1 1;<span class="keyword">...</span><span class="comment">.</span>
                   0 0 0 0 0 0 0 0;<span class="keyword">...</span><span class="comment">.</span>
                   1 1 1 1 0 0 0 0];
<span class="keyword">for</span> k = 1:8
  [v, f]  = ThrusterCAD( uThruster(:,k), dConeThruster, lThruster, 12, 0.7*dConeThruster,lThruster );
  s       = sprintf(<span class="string">'Thruster %d'</span>,k);
  m       = CreateComponent( <span class="string">'make'</span>, <span class="string">'generic'</span>, <span class="string">'v'</span>, v, <span class="string">'f'</span>, f, <span class="string">'faceColor'</span>, [0 0.5 0.5],<span class="keyword">...</span>
                       <span class="string">'rA'</span>,  rThruster(:,k), <span class="string">'mass'</span>, massREA , <span class="string">'name'</span>, s, <span class="string">'body'</span>, 1, <span class="string">'inside'</span>, 0 );
  BuildCADModel( <span class="string">'add component'</span>, m );
<span class="keyword">end</span>

<span class="comment">% Hydrazine tank</span>

vol  = massHyd/rhoHyd;
rHyd = (0.75*vol/pi)^(1/3);
m = CreateComponent( <span class="string">'make'</span>, <span class="string">'sphere'</span>, <span class="string">'radius'</span>,rHyd,<span class="keyword">...</span>
                     <span class="string">'faceColor'</span>, <span class="string">'steel'</span>,<span class="string">'rA'</span>, rABus,<span class="keyword">...</span>
                     <span class="string">'mass'</span>, massHyd+massTank, <span class="string">'name'</span>, <span class="string">'Hydrazine tank'</span>, <span class="string">'body'</span>, 1, <span class="string">'inside'</span>, 1 );
BuildCADModel( <span class="string">'add component'</span>, m );
</pre>
<img vspace="5" hspace="5" src="ManufacturingSpaceStationCAD_01.png" alt=""> <h2 id="4">Add subsystems</h2>
<pre class="codeinput">BuildCADModel( <span class="string">'add subsystem'</span>, <span class="string">'TT&amp;C'</span>,	      {<span class="string">'avionics'</span>, <span class="string">'imu'</span>, <span class="string">'star camera'</span>} );
BuildCADModel( <span class="string">'add subsystem'</span>, <span class="string">'Power'</span>,      {<span class="string">'battery'</span> <span class="string">'Solar'</span>} );
BuildCADModel( <span class="string">'add subsystem'</span>, <span class="string">'Robot arm'</span>,  {<span class="string">'link'</span> <span class="string">'rail'</span>} );
BuildCADModel( <span class="string">'add subsystem'</span>, <span class="string">'Propulsion'</span>, {<span class="string">'tank'</span>,<span class="string">'thruster'</span> <span class="string">'gimbal'</span>} );
BuildCADModel( <span class="string">'add subsystem'</span>, <span class="string">'Structure'</span>,  {<span class="string">'module'</span> <span class="string">'bus'</span> <span class="string">'keel'</span>} );
</pre>
<h2 id="5">Update the mass properties to produce the tables</h2>
<pre class="codeinput">BuildCADModel( <span class="string">'update body mass properties'</span> );
</pre>
<img vspace="5" hspace="5" src="ManufacturingSpaceStationCAD_02.png" alt=""> <h2 id="6">Show the vehicle and save the components</h2>
<pre class="codeinput">g = BuildCADModel( <span class="string">'get model'</span> );
BuildCADModel(<span class="string">'show vehicle'</span>);

<span class="keyword">if</span> saveFiles
  SaveStructure(g,<span class="string">'ManufacturingSpaceStation'</span>);
<span class="keyword">end</span>
</pre>
<img vspace="5" hspace="5" src="ManufacturingSpaceStationCAD_03.png" alt=""> <img vspace="5" hspace="5" src="ManufacturingSpaceStationCAD_04.png" alt=""> <h2 id="7">Export to an obj file for use by other software</h2>
<pre class="codeinput">ExportOBJ(g,<span class="string">'ManufacturingSpaceStation'</span>);

inr = diag(g.mass.inertia)';
inrC1 = LatexExp(inr(1),<span class="string">'8.2'</span>);
inrC2 = LatexExp(inr(2),<span class="string">'8.2'</span>);
inrC3 = LatexExp(inr(3),<span class="string">'8.2'</span>);
s = {};
k = 1;
s{k,1} = <span class="string">'Power'</span>;                    s{k,2} = sprintf(<span class="string">'%8.2f W'</span>,power); k = k + 1;
s{k,1} = <span class="string">'Orbit Altitude'</span>;           s{k,2} = sprintf(<span class="string">'%8.2f km'</span>,h); k = k + 1;
s{k,1} = <span class="string">'Mass'</span>;                     s{k,2} = sprintf(<span class="string">'%8.2f kg'</span>,g.mass.mass); k = k + 1;
s{k,1} = <span class="string">'[$I_{xx}~I_{yy}~I_{zz}$]'</span>; s{k,2} = sprintf(<span class="string">'[%s %s %s] kg-m$^2$'</span>,inrC1,inrC2,inrC3); k = k + 1;
s{k,1} = <span class="string">'Center of Mass'</span>;           s{k,2} = sprintf(<span class="string">'%8.2f %8.2f %8.2f m'</span>,g.mass.cM); k = k + 1;
s{k,1} = <span class="string">'Mass Xenon'</span>;               s{k,2} = sprintf(<span class="string">'%8.2f kg'</span>,massXe); k = k + 1;
s{k,1} = <span class="string">'Hall Thruster thrust'</span>;     s{k,2} = sprintf(<span class="string">'%8.2f mN'</span>,fHall*1000); k = k + 1;
s{k,1} = <span class="string">'Hall Thruster power'</span>;      s{k,2} = sprintf(<span class="string">'%8.2f kW'</span>,powerHall/1000);
DisplayLatexTable(s)
<span class="keyword">if</span> saveFiles
  CreateLatexTable(s,<span class="string">'ManufacturingSpaceStation'</span>); <span class="comment">% to save file</span>
<span class="keyword">end</span>
</pre>
<pre class="codeoutput">                   Power                                                                20000.00 W 
          Orbit Altitude                                                                 350.00 km 
                    Mass                                                               10641.71 kg 
[$I_{xx}~I_{yy}~I_{zz}$] [3.54 $\times 10^{5}$ 7.33 $\times 10^{4}$ 4.21 $\times 10^{5}$] kg-m$^2$ 
          Center of Mass                                                  6.86    -0.00    -0.03 m 
              Mass Xenon                                                                 159.47 kg 
    Hall Thruster thrust                                                                  20.21 mN 
     Hall Thruster power                                                                   0.34 kW 
</pre>
<h2 id="8">Compute the thruster torque distribution</h2>
<pre class="codeinput">ThrusterLayout( <span class="string">'initialize'</span>, <span class="string">'ManufacturingSpaceStation.obj'</span> );

[t,f,u] = ThrusterLayout( <span class="string">'update'</span>, -uThruster, rThruster, g.mass.cM );
fprintf(1,<span class="string">'\nFeasible = 1 means the torque can be achieved\n'</span>);
b = [1 -1 0 0 0 0;0 0 1 -1 0 0; 0 0 0 0 1 -1];
<span class="keyword">for</span> k = 1:6
	fprintf(1,<span class="string">'Torque demand = [%4.1f %4.1f %4.1f] u = [%4.2f %4.2f %4.2f %4.2f %4.2f %4.2f %4.2f %4.2f] Feasible = %d\n'</span>,b(:,k),u(:,k),f(k));
<span class="keyword">end</span>

<span class="keyword">if</span> saveFiles
  fThruster = fopen(<span class="string">'SpaceStationThruster.txt'</span>,<span class="string">'wt'</span>);
  <span class="keyword">for</span> k = 1:size(uThruster,2)
    fprintf(fThruster,<span class="string">'%8.4f %8.4f %8.4f %8.4f %8.4f %8.4f\n'</span>,rThruster,uThruster);
  <span class="keyword">end</span>
  fclose(fThruster);
<span class="keyword">end</span>

mass = g.mass;
</pre>
<pre class="codeoutput">
Feasible = 1 means the torque can be achieved
Torque demand = [ 1.0  0.0  0.0] u = [0.00 0.00 0.00 1.00 0.17 0.00 0.17 0.00] Feasible = 1
Torque demand = [-1.0  0.0  0.0] u = [0.00 0.00 1.00 0.00 0.17 0.00 0.17 0.00] Feasible = 1
Torque demand = [ 0.0  1.0  0.0] u = [0.18 0.18 0.00 0.00 0.00 0.00 0.00 0.00] Feasible = 1
Torque demand = [ 0.0 -1.0  0.0] u = [0.00 0.00 0.00 0.00 0.49 0.00 0.49 0.00] Feasible = 1
Torque demand = [ 0.0  0.0  1.0] u = [0.00 0.00 0.00 0.00 0.49 0.51 0.00 0.00] Feasible = 1
Torque demand = [ 0.0  0.0 -1.0] u = [0.00 0.00 0.00 0.00 0.00 0.00 0.49 0.51] Feasible = 1
</pre>
<img vspace="5" hspace="5" src="ManufacturingSpaceStationCAD_05.png" alt=""> <h2 id="9">Make a simple CAD Model for disturbance analyses</h2>
<pre class="codeinput">[v,f]     = Frustrum(rModule,rModule,sum(lModule),8);
v         = ([0 0 1;0 1 0;-1 0 0]*v')';
[vB,fB]   = Box(lBus,2*rModule,2*rModule);
vB(:,1)   = vB(:,1) + sum(lModule)+lBus/2;
f         = [f;fB+size(v,1)];
v         = [v;vB];

<span class="comment">% Solar wings</span>
rAW         = [sum(lModule(1:6))+lBus/2;rModule+lStrut+lSP/2;0];
[vW,fW]     = Box(tSP, lSP,wSP);
vW          = vW + rAW';

rAW         = [sum(lModule(1:6))+lBus/2;-rModule-lStrut-lSP/2;0];
[vW2,fW2]   = Box(tSP, lSP,wSP);
vW2         = vW2 + rAW';

fW          = [fW;fW2+size(vW,1)];
vW          = [vW;vW2];

[a,n,r]     = PolygonProps(v,f);
[aW,nW,rW]  = PolygonProps(vW,fW);
dSurf       = struct(<span class="string">'aB'</span>,a,<span class="string">'nB'</span>,n,<span class="string">'rB'</span>,r,<span class="string">'aW'</span>,aW,<span class="string">'nW'</span>,nW,<span class="string">'rW'</span>,rW);

<span class="comment">% Combine to draw</span>
f           = [f;fW+size(v,1)];
v           = [v;vW];

DrawVertices(v,f,<span class="string">'Simple Model'</span>);
</pre>
<img vspace="5" hspace="5" src="ManufacturingSpaceStationCAD_06.png" alt=""> <h2 id="10">Save the data for the simulation</h2>
<pre class="codeinput">
<span class="keyword">if</span> saveFiles
  <span class="keyword">if</span>( deployed )
    save(<span class="string">'SpaceStationProps'</span>,<span class="string">'mass'</span>, <span class="string">'rThruster'</span>,<span class="string">'uThruster'</span>,<span class="string">'dSurf'</span>)
  <span class="keyword">else</span>
    save(<span class="string">'SpaceStationPropsUndeployed'</span>,<span class="string">'mass'</span>, <span class="string">'rThruster'</span>,<span class="string">'uThruster'</span>,<span class="string">'dSurf'</span>)
  <span class="keyword">end</span>
<span class="keyword">end</span>

<span class="comment">%--------------------------------------</span>

<span class="comment">% $Id: 33eaaa03a2abd39c37fa5fb0510bdc7d6121c823 $</span>
</pre>
<p class="footer">
<br>
<a href="https://www.mathworks.com/products/matlab/">Published with MATLAB&reg; R2024a</a>
<br>
</p>
</div>
<!--
##### SOURCE BEGIN #####
%% Design a manufacturing space station
% Large space station with a Hall thruster for stationkeeping, hydrazine
% RCS thrusters, and a robot arm. There is an option for the solar arrays
% in the model to be deployed or not. This script creates both a full model
% and a simpler model for disturbance analysis. Both the full model, the
% thruster layout, and the simple model will be displayed in figures.
%
% If file saving is turned on, this script saves the following:
%
%  - ManufacturingSpaceStation.mat, the CAD model data structure 
%  - ManufacturingSpaceStation.tex, a latex table
%  - either the file SpaceStationProps.mat or SpaceStationPropsUndeployed.mat
%    with the simplified surface model and thruster layout data
%  - SpaceStationThruster.txt, the thruster layout data
%
% It will also export ManufacturingSpaceStation.obj as this is needed by
% the thruster layout step.
%
% See also AtmDens2, BuildCADModel, CreateBody, CreateComponent, 
% ExportOBJ, ThrusterCAD, XenonTank, VOrbit, HallThrusterArray, 
% ThrusterLayout, Box, Frustrum, DisplayLatexTable, SaveStructure, 
% DrawVertices, PolygonProps, DrawCanadarm3

%REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH
%   Copyright (c) 2025 Princeton Satellite Systems, Inc.
%   All rights reserved.
%REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH
%   Since version 2025.1
%REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH

% Script control
deployed   = true;
saveFiles  = false;

% Constants
rhoAl    = 2700;
rhoGlass = 2500;
rhoXe    = 3100; % km/m^2
rhoTi    = 4502; % kg/m^3
rE       = 6378.165;
tRefuel  = 5*365.25*24*3600; % 5 years
sigTi    = 0.5*880e6; % N/m^2 with a factor of safety of 2
effHall  = 0.6;
uEHall   = 20000; % m/s
massREA  = 0.3;
massHyd  = 200;
pHyd     = 350*6895;
rhoHyd   = 1000;

%% Properties

% Orbit
h  = 350; % km
cD = 2.7;

% Tank
pTank = 350*6895;

% Manufacturing modules
nModules    = 6;
rModule     = 1.0; % m
lModule     = 1.2*ones(1,6);  % m
massModule  = 500*ones(1,6);
useModule   = [1 1 1 1 1 1];

% Bus
lBus        = 2*lModule(1);  % m
massBus     = 2000;

% Rail for the robot arm
xRail       = sum(lModule(1:6));
yRail       = 0.1;
zRail       = 0.1;
massRail    = xRail*yRail*zRail*rhoAl*0.1;

% Keel
xKeel       = sum(lModule(1:6));
yKeel       = 0.2;
zKeel       = 0.2;
massKeel    = xKeel*yKeel*zKeel*rhoAl*0.1;

% Solar Panels
power     = 20000;
eff       = 0.31;
areaSP    = power/(eff*1367)/2;
wSP       = 2*rModule;
lSP       = areaSP/wSP;
tSP       = 0.04;
lStrut    = rModule;
massPanel = wSP*tSP*lSP*rhoGlass;
massStrut = lStrut*tSP^2*rhoAl;

% Hall Thruster
massHallThruster       = 3;
wHallThruster          = 0.5;
rHallThrusterGimbal    = 0.25*wHallThruster;
lHallThrusterGimbal    = 0.5*wHallThruster;
massHallThrusterGimbal = 0.75;

% Fuel Tank
r         = rE + h;
v         = VOrbit(r,r)*1000;
fHall     = 0.5*AtmDens2(h)*cD*v^2*(areaSP+4*rModule^2);
powerHall = 0.5*fHall*uEHall/effHall;

massXe   = fHall*tRefuel/uEHall;
volXe    = massXe/rhoXe;
rXeTank  = (0.75*volXe/pi)^(1/3);
tWall    = pTank*rXeTank/(2*sigTi);
massTank = tWall*4*pi*rXeTank^2;

% Robot arm
rLink    = 0.2; % m
lLink    = 2; % m
nLinks   = 3; % m
tLink    = 0.002; % Thickness of link strut m
angY     = [0 0 pi/4 pi/4]; % Just for the picture
massLink = tLink*2*pi*rLink*lLink*rhoAl;
xRobotArm = 2.2*lModule(1);

%% Initialize BuildCADModel and create the Core body
BuildCADModel( 'initialize' );
BuildCADModel( 'set name' , 'Manufacturing Space Station' );
BuildCADModel( 'set units', 'mks' );

% Core
m = CreateBody('make','name','Core');
BuildCADModel('add body', m );

% This creates the connections between the bodies
BuildCADModel( 'compute paths' );

% Modules
rA = [0;0;0];
for k = 1:nModules
  if( useModule(k))
    name = sprintf('Module %d',k);
    m = CreateComponent( 'make', 'cylinder', 'rUpper', rModule, 'rLower',rModule,'h',lModule(k),...
                     'n',20,'faceColor', 'gold foil','rA', rA,'b',[0 0 1;0 1 0;-1 0 0],...
                     'mass', massModule(k), 'name', name, 'body', 1, 'inside', 0 );
    BuildCADModel( 'add component', m );
  end
  rA(1) = rA(1) + lModule(k);
end

rA(1) = rA(1) + lBus/2;
rABus = rA;
m = CreateComponent( 'make', 'box', 'x', lBus, 'y',2*rModule,'z',2*rModule,...
                     'faceColor', 'Steel','rA', rABus,...
                     'mass', massBus, 'name', 'Bus', 'body', 1, 'inside', 0 );
BuildCADModel( 'add component', m );


% Add the keel and lateral supports
rA = [sum(lModule(1:3));0;-rModule-zKeel/2];
m = CreateComponent( 'make', 'box', 'x', xKeel, 'y',yKeel,'z',zKeel,...
                     'faceColor', 'aluminum','rA', rA,...
                     'mass', massKeel, 'name', 'Keel', 'body', 1, 'inside', 0 );
BuildCADModel( 'add component', m );

rA = [sum(lModule(1:3));-rModule-zKeel/2;0];
m = CreateComponent( 'make', 'box', 'x', xKeel, 'y',yKeel,'z',zKeel,...
                     'faceColor', 'aluminum','rA', rA,...
                     'mass', massKeel, 'name', 'Lateral 1', 'body', 1, 'inside', 0 );
BuildCADModel( 'add component', m );

rA = [sum(lModule(1:3));rModule+zKeel/2;0];
m = CreateComponent( 'make', 'box', 'x', xKeel, 'y',yKeel,'z',zKeel,...
                     'faceColor', 'aluminum','rA', rA,...
                     'mass', massKeel, 'name', 'Lateral 2', 'body', 1, 'inside', 0 );
BuildCADModel( 'add component', m );

%  Module supports
rA = [lModule(1)/2-lModule(1)/12;0;0];
rI = rModule;
rO = 1.01*rModule;
lS = lModule(1)/6;
massSupport = rhoAl*pi*(rO^2-rI^2)*lS;
for k = 1:6
  [v,f] = PartialThickDisk(rI,rO,lS,12,-pi/2,pi/2);
  s     = sprintf('Module Support %d',k);
  m = CreateComponent( 'make', 'generic', 'vertex',v, 'face',f,...
                     'faceColor', 'steel','rA', rA,'b',[0 0 1;0 1 0;-1 0 0],...
                     'mass', massSupport, 'name', s, 'body', 1, 'inside', 0 );
  BuildCADModel( 'add component', m );
  rA(1) = rA(1)+lModule(1);
end

% Solar panels and support struts
if( deployed )
  signY = 1;
  for k = 1:2
    nameP = sprintf('Solar Panel %d',k);
    rAW = [sum(lModule(1:6))+lBus/2;signY*(rModule+lStrut+lSP/2);0];
    m = CreateComponent( 'make', 'box', 'x', tSP, 'y',lSP,'z',wSP,...
                         'faceColor', 'solar cell','rA', rAW,...
                          'mass', massPanel, 'name', nameP, 'body', 1, 'inside', 0 );
    BuildCADModel( 'add component', m );

    nameS = sprintf('Solar Panel Strut %d',k);

    rAW(2) = signY*(rModule+lStrut/2);
    m = CreateComponent( 'make', 'box', 'x', tSP, 'y',lStrut,'z',tSP,...
                     'faceColor', 'aluminum','rA', rAW,...
                     'mass', massStrut, 'name', nameS, 'body', 1, 'inside', 0 );
    BuildCADModel( 'add component', m );
    signY = -signY;
  end
else
  signY = 1;
  for k = 1:2
    nameP = sprintf('Solar Panel %d',k);
    rA = rABus + [-lSP/2;signY*(rModule);0];
    lSPD = 0.5*lSP;
    m = CreateComponent( 'make', 'box', 'x',lSPD, 'y', tSP,'z',wSP,...
                         'faceColor', 'solar cell','rA', rA,...
                          'mass', massPanel, 'name', nameP, 'body', 1, 'inside', 0 );
    BuildCADModel( 'add component', m );

    nameS = sprintf('Solar Panel Strut %d',k);

    rA  = rA + [lSP/2;-signY*(rModule);0];
    m = CreateComponent( 'make', 'box', 'x',lStrut, 'y',tSP,'z',tSP,...
                     'faceColor', 'aluminum','rA', rA,...
                     'mass', massStrut, 'name', nameS, 'body', 1, 'inside', 0 );
    BuildCADModel( 'add component', m );
    signY = -signY;
  end

end

% Hall Thruster
[v, f] = HallThrusterArray( wHallThruster );
rA     = [sum(lModule)+2*rHallThrusterGimbal+lBus;0;0];
b      = [0 0 1;0 1 0;-1 0 0];
m = CreateComponent( 'make', 'generic', 'vertex',v, 'face',f,...
                     'faceColor', 'steel','rA', rA,'b',b,...
                     'mass', massHallThruster, 'name', 'Hall Thruster', 'body', 1, 'inside', 0 );
BuildCADModel( 'add component', m );
rA     = [sum(lModule)+2*rHallThrusterGimbal+lBus;0;-lHallThrusterGimbal/2];
rA     = rA -[rHallThrusterGimbal;0;0];
m = CreateComponent( 'make', 'cylinder', 'rUpper',rHallThrusterGimbal, 'rLower',rHallThrusterGimbal,'h',lHallThrusterGimbal,...
                     'faceColor', 'steel','rA', rA,...
                     'mass', massHallThrusterGimbal, 'name', 'Hall Thruster Gimbal', 'body', 1, 'inside', 0 );
BuildCADModel( 'add component', m );

[v,f,dTank] = XenonTank(massXe);
rA = [sum(lModule)+2*rHallThrusterGimbal+lBus;0;0] - [1;0;0.8];
m = CreateComponent( 'make', 'generic', 'vertex',v, 'face',f,...
                     'faceColor', 'steel','rA', rA,...
                     'mass', massXe+dTank.massTank, 'name', 'Xenon tank', 'body', 1, 'inside', 1 );
BuildCADModel( 'add component', m );

d      = DrawCanadarm3( 'initialize' );
x      = zeros(7,1);
[v,f]  = DrawCanadarm3( 'vectors', x, d );

m = CreateComponent( 'make', 'generic', 'vertex',v, 'face',f,...
                     'faceColor', 'steel','rA', rA,...
                     'mass', 100, 'name', 'Robot Arm', 'body', 1, 'inside', 1 );
BuildCADModel( 'add component', m );

% RCS hydrazine thrusters
lThruster     = 0.026;
dConeThruster = 0.02;
r             = rModule;
x             = lBus/2;

rThruster     = rABus + [x  x -x -x x  x  x  x;...
                         r -r  r -r r  r -r -r;...
                         r  r  r  r r -r  r -r];
uThruster     =  [ 0 0 0 0 1 1 1 1;....
                   0 0 0 0 0 0 0 0;....
                   1 1 1 1 0 0 0 0];
for k = 1:8
  [v, f]  = ThrusterCAD( uThruster(:,k), dConeThruster, lThruster, 12, 0.7*dConeThruster,lThruster );
  s       = sprintf('Thruster %d',k);
  m       = CreateComponent( 'make', 'generic', 'v', v, 'f', f, 'faceColor', [0 0.5 0.5],...
                       'rA',  rThruster(:,k), 'mass', massREA , 'name', s, 'body', 1, 'inside', 0 );
  BuildCADModel( 'add component', m );
end

% Hydrazine tank

vol  = massHyd/rhoHyd;
rHyd = (0.75*vol/pi)^(1/3);
m = CreateComponent( 'make', 'sphere', 'radius',rHyd,...
                     'faceColor', 'steel','rA', rABus,...
                     'mass', massHyd+massTank, 'name', 'Hydrazine tank', 'body', 1, 'inside', 1 );
BuildCADModel( 'add component', m );

%% Add subsystems
BuildCADModel( 'add subsystem', 'TT&C',	      {'avionics', 'imu', 'star camera'} );
BuildCADModel( 'add subsystem', 'Power',      {'battery' 'Solar'} );
BuildCADModel( 'add subsystem', 'Robot arm',  {'link' 'rail'} );
BuildCADModel( 'add subsystem', 'Propulsion', {'tank','thruster' 'gimbal'} );
BuildCADModel( 'add subsystem', 'Structure',  {'module' 'bus' 'keel'} );

%% Update the mass properties to produce the tables
BuildCADModel( 'update body mass properties' );

%% Show the vehicle and save the components
g = BuildCADModel( 'get model' );
BuildCADModel('show vehicle');

if saveFiles
  SaveStructure(g,'ManufacturingSpaceStation');
end

%% Export to an obj file for use by other software
ExportOBJ(g,'ManufacturingSpaceStation');

inr = diag(g.mass.inertia)';
inrC1 = LatexExp(inr(1),'8.2');
inrC2 = LatexExp(inr(2),'8.2');
inrC3 = LatexExp(inr(3),'8.2');
s = {};
k = 1;
s{k,1} = 'Power';                    s{k,2} = sprintf('%8.2f W',power); k = k + 1;
s{k,1} = 'Orbit Altitude';           s{k,2} = sprintf('%8.2f km',h); k = k + 1;
s{k,1} = 'Mass';                     s{k,2} = sprintf('%8.2f kg',g.mass.mass); k = k + 1;
s{k,1} = '[$I_{xx}~I_{yy}~I_{zz}$]'; s{k,2} = sprintf('[%s %s %s] kg-m$^2$',inrC1,inrC2,inrC3); k = k + 1;
s{k,1} = 'Center of Mass';           s{k,2} = sprintf('%8.2f %8.2f %8.2f m',g.mass.cM); k = k + 1;
s{k,1} = 'Mass Xenon';               s{k,2} = sprintf('%8.2f kg',massXe); k = k + 1;
s{k,1} = 'Hall Thruster thrust';     s{k,2} = sprintf('%8.2f mN',fHall*1000); k = k + 1;
s{k,1} = 'Hall Thruster power';      s{k,2} = sprintf('%8.2f kW',powerHall/1000); 
DisplayLatexTable(s)
if saveFiles
  CreateLatexTable(s,'ManufacturingSpaceStation'); % to save file
end

%% Compute the thruster torque distribution
ThrusterLayout( 'initialize', 'ManufacturingSpaceStation.obj' );

[t,f,u] = ThrusterLayout( 'update', -uThruster, rThruster, g.mass.cM );
fprintf(1,'\nFeasible = 1 means the torque can be achieved\n');
b = [1 -1 0 0 0 0;0 0 1 -1 0 0; 0 0 0 0 1 -1];
for k = 1:6
	fprintf(1,'Torque demand = [%4.1f %4.1f %4.1f] u = [%4.2f %4.2f %4.2f %4.2f %4.2f %4.2f %4.2f %4.2f] Feasible = %d\n',b(:,k),u(:,k),f(k));
end

if saveFiles
  fThruster = fopen('SpaceStationThruster.txt','wt');
  for k = 1:size(uThruster,2)
    fprintf(fThruster,'%8.4f %8.4f %8.4f %8.4f %8.4f %8.4f\n',rThruster,uThruster);
  end
  fclose(fThruster);
end

mass = g.mass;

%% Make a simple CAD Model for disturbance analyses

[v,f]     = Frustrum(rModule,rModule,sum(lModule),8);
v         = ([0 0 1;0 1 0;-1 0 0]*v')';
[vB,fB]   = Box(lBus,2*rModule,2*rModule);
vB(:,1)   = vB(:,1) + sum(lModule)+lBus/2;
f         = [f;fB+size(v,1)];
v         = [v;vB];

% Solar wings
rAW         = [sum(lModule(1:6))+lBus/2;rModule+lStrut+lSP/2;0];
[vW,fW]     = Box(tSP, lSP,wSP);
vW          = vW + rAW';

rAW         = [sum(lModule(1:6))+lBus/2;-rModule-lStrut-lSP/2;0];
[vW2,fW2]   = Box(tSP, lSP,wSP);
vW2         = vW2 + rAW';

fW          = [fW;fW2+size(vW,1)];
vW          = [vW;vW2];

[a,n,r]     = PolygonProps(v,f);
[aW,nW,rW]  = PolygonProps(vW,fW);
dSurf       = struct('aB',a,'nB',n,'rB',r,'aW',aW,'nW',nW,'rW',rW);

% Combine to draw
f           = [f;fW+size(v,1)];
v           = [v;vW];

DrawVertices(v,f,'Simple Model');

%% Save the data for the simulation
if saveFiles
  if( deployed )
    save('SpaceStationProps','mass', 'rThruster','uThruster','dSurf')
  else
    save('SpaceStationPropsUndeployed','mass', 'rThruster','uThruster','dSurf')
  end
end

%REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH
% $Date:   2025-05-22 $
% $Id: 33eaaa03a2abd39c37fa5fb0510bdc7d6121c823 $

##### SOURCE END #####
-->
</body>
</html>
